<!DOCTYPE html>
<html id="spryker-academy" lang="en-us" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Developing with Spryker|Module Guide|Yves Components|Search">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../../../../Skins/Favicons/browserconfig.xml" />
        <link rel="apple-touch-icon" sizes="180x180" href="../../../../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../../../../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../../../Skins/Favicons/favicon-16x16.png" />
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0" />
        <meta name="author" content="Spryker Systems GmbH" />
        <meta name="title" content="Welcome to Spryker Academy" />
        <meta name="msapplication-config" content="/resources/public/images/favicons/browserconfig.xml" />
        <link rel="apple-touch-icon" sizes="180x180" href="/resources/public/images/favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="/resources/public/images/favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="/resources/public/images/favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="/resources/public/images/favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="/resources/public/images/favicons/favicon-16x16.png" /><title>Search 4.0</title>
        <link href="../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <style>@import url('https://fonts.googleapis.com/css?family=Lato:300,400,400i,900');

</style>
        <style>/*&lt;meta /&gt;*/

.button.previous-topic-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/navigate-previous.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.next-topic-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/navigate-next.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.print-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/printer.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.expand-all-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/expand.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.collapse-all-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/collapse.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.needs-pie
{
	behavior: url('../../../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <link href="../../../../resources/public/css/academy-ui-style.css" rel="stylesheet" />
        <script src="../../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body class="t-base t-base--page js-base-template">
        <div class="t-base__header">
            <header class="o-header">
                <div class="o-header__content g-grid g-grid--container g-grid--middle"><a class="m-logo g-col g-col--sm-10 g-col--lg-2" href="/"><img class="m-logo__image" src="/resources/public/images/logo.png" alt="Spryker Logo" /></a>
                    <nav class="m-nav-top g-col g-col--sm-2 g-col--lg-10" id="nav-top">
                        <div class="u-is-hidden--sm-xl">
                            <ul class="nocontent menu _Skins_SideMenu mc-component" data-mc-linked-toc="Data/Tocs/spryker_content.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                            </ul>
                        </div>
                        <div class="u-is-hidden--xl"><a class="m-nav-top__toggler js-base-template__toggler" href="#"><span class="icon icon-bars"></span></a>
                        </div>
                    </nav>
                </div>
            </header>
        </div>
        <div class="t-base__frame">
            <section class="o-search">
                <div class="g-grid g-grid--container">
                    <section class="m-search g-col g-col--sm-12">
                        <form action="/search.html" method="GET">
                            <input class="a-input a-input--expanded m-search__input" placeholder="Search in the Academy..." name="q" />
                            <button class="m-search__submit" type="submit"><span class="icon icon-search"></span>
                            </button>
                        </form>
                    </section>
                </div>
            </section>
            <section class="t-base__widgets g-grid g-grid--container">
                <section class="m-breadcrumbs g-col g-col--sm-12 g-col--xl-8">
                    <div class="nocontent">
                        <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                        </div>
                    </div>
                </section>
                <div class="g-col g-col--sm-12 g-col--xl-4">
                    <section class="m-widget-toolbar">
                        <div class="buttons popup-container clearfix topicToolbarProxy _Skins_TopicToolBar mc-component nocontent">
                            <div class="button-group-container-left">
                                <button class="button needs-pie previous-topic-button" title="Navigate previous">
                                    <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="previous topic" />
                                </button>
                                <button class="button needs-pie next-topic-button" title="Navigate next">
                                    <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="next topic" />
                                </button>
                                <button class="button needs-pie print-button" title="Print">
                                    <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="print" />
                                </button>
                                <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                    <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="expand all" />
                                </button>
                            </div>
                        </div>
                    </section>
                </div>
            </section>
            <main class="t-base__main g-grid g-grid--container">
                <div class="g-col g-col--sm-12 u-is-hidden--xl">
        menu here
    </div>
                <div class="t-page-sidebar__content o-content g-col g-col--sm-12 g-col--xl-8 js-anchorer js-highlighter js-widget-copy">
                    <h1>Search 4.0</h1>
                    <p><a href="javascript:void(0);" class="MCHelpControl MCHelpControl-Related relatedTopics" data-mc-topics="Search 3.0|search_3_0.html||Search 4.0|search_4_0.html||Search|search.html" target="_self" style="mc-label: 'Previous Versions:';mc-help-control-display: popup;"><span class="MCHelpControl-RelatedHotSpot_"><img class="MCHelpControl_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="16" width="16" alt="Related Topics Link Icon" />Previous Versions:</span></a>
                    </p>
                    <p>One of the most important features in an e-commerce application is to give the customer the ability to find the specific products. Depending on how easy it is to find the products the customer is searching for and how relevant the search results are, the search feature is a crucial aspect for an e-commerce business.</p>
                    <p>Spryker provides a fully functional solution to integrate <var>Elasticsearch</var> as a search engine. You can extend this solution or customize it to fit for your needs.</p>
                    <p>Spryker uses <a href="https://www.elastic.co/products/elasticsearch" target="_blank">Elasticsearch</a> version 2.x.</p>
                    <p>We’ll have a look on how to configure and use the <var>Search</var> <span class="Generalbundle/module">module</span>:</p>
                    <ul>
                        <li value="1">Configure Elasticsearch</li>
                        <li value="2">Search Collector Configuration</li>
                        <li value="3">Search Query</li>
                        <li value="4">Configure Search Features</li>
                    </ul>
                    <h2>Previous Versions</h2>
                    <ul>
                        <li value="1"><a href="search_3_0.html">Search - version 3.0</a>
                        </li>
                    </ul>
                    <h2>Configure Elasticsearch</h2>
                    <p>Elasticsearch is a <var>NoSQL</var> data store which allows us to predefine the structure of the data we’ll be storing in it.</p>
                    <p>Since the data structure we use is static, we would like to define it in advance. The definitions of the indexes and mapping types are written in <var>JSON</var> format, just as you’ll find it in the <var>Elasticsearch</var> documentation.</p>
                    <p>The content of the configuration files needs to follow the conventions of the official <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-create-index.html" target="_blank" title="elasticsearch" alt="elasticsearch">Elasticsearch index creation</a> documentation. Note that the current search installer support only settings and mappings but if you need more, feel free to extend it on the project level.</p>
                    <p class="info">
                        <br /><strong>Default Schema</strong>
                        <br />You can find the default schema configuration file at <var>vendor/spryker/search/src/Spryker/Shared/Search/IndexMap/search.json</var>.<br /></p>
                    <p class="info">
                        <br /><strong>Tip</strong>
                        <br />If you want to disable the installation of the default mapping, you need to override the core configuration defined in <var>Spryker\Zed\Search\SearchConfig::getJsonIndexDefinitionDirectories()</var> by implementing it on the project level (e.g. <var>Pyz\Zed\Search\SearchConfig</var>).<br /></p>
                    <p>Each configured <a href="../../../../enablement/howtos/ht_setup_stores_mutli_store_projects.html"><a href="http://spryker.github.io/tutorials/reference/multi-store-projects/" target="_blank">store</a></a> will have its own index installed automatically. The name of the indexes are composed from store name + underscore + configuration file name (e.g.: <var>de_search</var>).</p>
                    <h3>Defining new indexes and mapping types</h3>
                    <p>You can define new indexes and mapping types by creating new configuration files under the <var>Shared</var> namespace of any <span class="Generalbundle/module">module</span>.</p>
                    <p>Example:</p>
                    <ul>
                        <li value="1"><var>src/Shared/MyBundleName/IndexMap/myindex.json</var>
                        </li>
                    </ul>
                    <p>You are able to extend or overwrite existing configurations by creating a new file with the same name you wish to modify and provide only the differences compared to the original one.</p>
                    <p>When the search installer runs, it will first read all the available configuration files and merge them by index name per each store. This might be handy if you have bundles which are not tightly coupled together but both need to use the same index for some reason or you just need to extend or override the default configuration provided on the Core level.</p>
                    <p>It’s also possible to extend or modify indexes and mapping types for specific stores. All you need to do is to create a new configuration file along with the name of the store (e.g. <var>de_search.json</var>) and it will be only used for that store. For example, you might have a different analysing strategy for your stores, so you’ll need to define it separately.</p>
                    <h3>Installing indexes and mapping types</h3>
                    <p>Execute the following command to run the installation process:</p><pre><code class="bash">vendor/bin/console setup:search</code></pre>
                    <p>This will install indexes which are not yet created and <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-put-mapping.html" target="_blank">update the mapping types</a> based on the <var>JSON</var> configurations.</p>
                    <p>Note that if an index is created with the given settings, it won’t be changed by running this process, but the mapping can be modified and will be changed.</p>
                    <p>In development environment, if you need to create new analysers or change the index settings, you need to delete the index first and run the install process again.</p>
                    <p>When you run the search installer for every mapping type, a helper class will be auto-generated. You can find these classes under the <var>\Generated\Search\IndexMap</var> namespace. The name of the generated class starts with the name of the mapping type and is suffixed with <var>IndexMap</var>.</p>
                    <p>For the default page mapping type, the class is <var>\Generated\Search\IndexMap\PageIndexMap</var>.</p>
                    <p>These classes provide some information from the mapping type, such as the fields and the metadata. Use these classes for references when you need to program against something related to the schema of that mapping type.</p>
                    <p>If you change a mapping type and run the installer, the auto-generated classes will also change accordingly.</p>
                    <h3>Search Collector Configuration</h3>
                    <p>In this section you’ll learn how to easily map collected data from the database to the default Elasticsearch page mapping type.</p>
                    <p>If you need information about how collectors work in general, you can read more about it on the <a href="../../infrastructure/collector/collector.html" target="_blank">Collector</a> documentation page.</p>
                    <p>First, you need to implement <var>\Spryker\Zed\Search\Dependency\Plugin\PageMapInterface</var> interface as a plugin. This interface contains the <var>buildPageMap()</var> method which will be called for each collected document and its responsibility is to create a <var>PageMapTransfer</var> object and fill it with the mapped data. Basically, this transfer object represents one document in the page type.</p>
                    <p>The <var>buildPageMap()</var> method provides an instance of <var>\Spryker\Zed\Search\Business\Model\Elasticsearch\DataMapper\PageMapBuilderInterface</var> to help to fill this transfer object with the correct data in the correct format. It’s really easy to use, all you need to do is to tell the PageMapBuilder which data you need to have in the search result data, which data you want to filter by, which data you want to sort by, etc.</p>
                    <div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Click to expand the code sample</a></span>
                        <div class="MCDropDownBody dropDownBody"><pre><code class="bash">&lt;?php

    /**
     * @param \Spryker\Zed\Search\Business\Model\Elasticsearch\DataMapper\PageMapBuilderInterface $pageMapBuilder
     * @param array $productData
     * @param \Generated\Shared\Transfer\LocaleTransfer $locale
     *
     * @return \Generated\Shared\Transfer\PageMapTransfer
     */
    public function buildPageMap(PageMapBuilderInterface $pageMapBuilder, array $productData, LocaleTransfer $locale)
    {
        $pageMapTransfer = (new PageMapTransfer())
            -&gt;setStore(Store::getInstance()-&gt;getStoreName())
            -&gt;setLocale($locale-&gt;getLocaleName());

        $price = $this-&gt;getPriceBySku($productData['abstract_sku']);

        $pageMapBuilder
            -&gt;addSearchResultData($pageMapTransfer, 'id_product_abstract', $productData['id_product_abstract'])
            -&gt;addSearchResultData($pageMapTransfer, 'abstract_sku', $productData['abstract_sku'])
            -&gt;addSearchResultData($pageMapTransfer, 'abstract_name', $productData['abstract_name'])
            -&gt;addSearchResultData($pageMapTransfer, 'price', $price)
            -&gt;addSearchResultData($pageMapTransfer, 'url', $this-&gt;getProductUrl($productData))
            -&gt;addSearchResultData($pageMapTransfer, 'available', $this-&gt;isAvailable($productData)
            -&gt;addFullTextBoosted($pageMapTransfer, $productData['abstract_name'])
            -&gt;addSuggestionTerms($pageMapTransfer, $productData['abstract_name'])
            -&gt;addCompletionTerms($pageMapTransfer, $productData['abstract_name'])
            -&gt;addStringSort($pageMapTransfer, 'name', $productData['abstract_name'])
            -&gt;addIntegerSort($pageMapTransfer, 'price', $price)
            -&gt;addIntegerFacet($pageMapTransfer, 'price', $price)
            -&gt;addCategory($pageMapTransfer, $this-&gt;getAllParentCategories($productData), $this-&gt;getDirectParentCategories($productData));

        return $pageMapTransfer;
    }</code></pre>
                        </div>
                    </div>
                    <p>In the example above, you can see that first we create the <var>PageMapTransfer</var> instance, add some metadata to it, then with the help of the <var>PageMapBuilderInterface</var> we can easily map some data to the transfer.</p>
                    <p>At the end, we’ll get the data for a document similar to the example below:</p>
                    <div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Click to expand the code sample</a></span>
                        <div class="MCDropDownBody dropDownBody"><pre><code class="bash">{
   "store": "DE",
   "locale": "en_US",
   "search-result-data": {
      "id_product_abstract": 1,
      "abstract_sku": "foo",
      "abstract_name": "Lorem ipsum",
      "url": "/lorem-ipsum",
      "price": 1234,
      "available": true
   },
   "full-text-boosted": [
      "Lorem ipsum"
   ],
   "suggestion-terms": [
      "Lorem ipsum"
   ],
   "completion-terms": [
      "Lorem ipsum"
   ],
   "string-sort": {
      "name": "Lorem ipsum"
   },
   "integer-sort": {
      "price": 1234
   },
   "integer-facet": [
      {
         "facet-name": "price",
         "facet-value": 1234
      }
   ],
   "category": {
      "direct-parents": [
         "1"
      ],
      "all-parents": [
         "1",
         "2",
         "3"
      ]
   }
}</code></pre>
                        </div>
                    </div>
                    <p>After implementing our <i>PageMap</i> plugin we need to make sure that we also use it in our collector.</p>
                    <p>The collector has the <var>collectItem()</var> method which has the data for our PageMap plugin to generate the <var>PageMapTransfer</var>. The <var>collectItem()</var> by definition needs to return an array which is exactly the final data for one document pushed to <var>Elasticsearch</var>.</p>
                    <p>To transform the generated <var>PageMapTransfer</var> into the final document in the right format, use the <var>transformPageMapToDocument()</var> method of the <var>SearchFacade</var>.</p>
                    <p>In the example below you can see how the <i>PageMap</i> plugin is used in the <var>ProductCollector</var> from Demoshop.</p>
                    <div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Click to expand the code sample</a></span>
                        <div class="MCDropDownBody dropDownBody"><pre><code class="bash">&lt;?php
namespace Pyz\Zed\Collector\Business\Search;

use Spryker\Zed\Collector\Business\Collector\Search\AbstractSearchPdoCollector;
use Spryker\Zed\Search\Business\SearchFacadeInterface;
use Spryker\Zed\Search\Dependency\Plugin\PageMapInterface;

class ProductCollector extends AbstractSearchPdoCollector
{

    /**
     * @var \Spryker\Zed\Search\Dependency\Plugin\PageMapInterface
     */
    protected $productDataPageMapPlugin;

    /**
     * @var \Spryker\Zed\Search\Business\SearchFacadeInterface
     */
    protected $searchFacade;

    /**
     * @param \Spryker\Zed\Search\Dependency\Plugin\PageMapInterface $productDataPageMapPlugin
     * @param \Spryker\Zed\Search\Business\SearchFacadeInterface $searchFacade
     */
    public function __construct(PageMapInterface $productDataPageMapPlugin, SearchFacadeInterface $searchFacade)
    {
        $this-&gt;productDataPageMapPlugin = $productDataPageMapPlugin;
        $this-&gt;searchFacade = $searchFacade;
    }

    /**
     * @param string $touchKey
     * @param array $collectItemData
     *
     * @return array
     */
    protected function collectItem($touchKey, array $collectItemData)
    {
        return $this
            -&gt;searchFacade
            -&gt;transformPageMapToDocument($this-&gt;productDataPageMapPlugin, $collectItemData, $this-&gt;locale);
    }

}</code></pre>
                        </div>
                    </div>
                    <h3>Dynamic product attribute mapping</h3>
                    <p>Product attributes can be changed in time, when for example a shop decides to add a few new types of products to the catalogue.</p>
                    <p>As we saw earlier, it’s possible to configure which data you provide for Elasticsearch. It also can be applied for product attributes, but it’s not too effective that developers need to take care of them if they are changing a lot.</p>
                    <p>For this reason, the <i>ProductSearch</i> <span class="Generalbundle/module">module</span> provides an extra feature that allows you to dynamically map product attributes to the documents for Elasticsearch page type.</p>
                    <p>In the database there is a <var>spy_product_search_attribute_map</var> table that contains two fields:</p>
                    <ul>
                        <li value="1"><var>fk_product_attributes_metadata</var> which is the foreign key of the product attribute</li>
                        <li value="2"><var>target_field</var> which is a string, representing the field name from the Elasticsearch page type.</li>
                    </ul>
                    <p>If you feed this table with data (by building a UI in Zed, or in any other way) you can easily extend the previously implemented <var>buildPageMap()</var> method by calling <i>ProductSearchFacade’s</i> <var>mapDynamicProductAttributes()</var> at the end.</p>
                    <p>So let’s extend our previous example of <var>buildPageMap()</var>.</p><pre><code class="bash">&lt;?php

    /**
     * @param \Spryker\Zed\Search\Business\Model\Elasticsearch\DataMapper\PageMapBuilderInterface $pageMapBuilder
     * @param array $productData
     * @param \Generated\Shared\Transfer\LocaleTransfer $locale
     *
     * @return \Generated\Shared\Transfer\PageMapTransfer
     */
    public function buildPageMap(PageMapBuilderInterface $pageMapBuilder, array $productData, LocaleTransfer $locale)
    {
        // ...

        $pageMapTransfer = $this
            -&gt;productSearchFacade
            -&gt;mapDynamicProductAttributes($pageMapBuilder, $pageMapTransfer, $attributes);

        return $pageMapTransfer;
    }</code></pre>
                    <p class="info">
                        <br /><strong>Zed UI for product attribute mapping</strong>
                        <br />It's in Spryker's pipeline to provide an easy to use Zed UI for product dynamic attribute mapping.<br /></p>
                    <h2>Search Query</h2>
                    <p>Now we have all necessary data in Elasticsearch, it’s time to display them in <i>Yves</i>.</p>
                    <p>In order to achieve this, we first need to query Elasticsearch, which will return raw data for us that we need to process and prepare to display it in our templates.</p>
                    <p>In the <var>SearchClient</var> you can find the <var>search()</var> method (<var>\Spryker\Client\Search\SearchClientInterface::search()</var>).</p>
                    <p>This is the method that you need to call to execute any search query. It expects to receive an instance of <var>\Spryker\Client\Search\Dependency\Plugin\QueryInterface</var> as first parameter, which represents the query itself, and a collection of <var>\Spryker\Client\Search\Dependency\Plugin\ResultFormatterPluginInterface</var> instances which will be applied on the response data to format it.</p>
                    <h3>Querying Elasticsearch</h3>
                    <p>The first thing we need to do is to implement the <i>QueryInterface</i>. To communicate with Elasticsearch. Spryker uses the <a href="http://elastica.io/" target="_blank">Elastica</a> library as a <i>Data Query Language</i>.</p>
                    <p>Inside the <var>QueryInterface</var> you need to create an instance of <var>\Elastica\Query</var>, configure it to fit your needs, then return it with <var>getSearchQuery()</var>.</p>
                    <p>This is the point where configuring the query is completely up to you, use Elastica to alter the query for your needs, add filters, aggregations, boosts, sorting, pagination or anything else you like and Elasticsearch enables you.</p>
                    <p class="info">
                        <br /><strong>Tip</strong>
                        <br />The <var>QueryInterface</var> instance is a stateful class; sometimes <var>getSearchQuery()</var> method is called multiple times and alters the original query (see: Expandig queries), so you need to make sure that it returns the same instance. This can be achieved by creating the <var>\Elastica\Query</var> instance atconstruction time and just return it in the getSearchQuery() method.<br /></p>
                    <div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Click to expand the code sample</a></span>
                        <div class="MCDropDownBody dropDownBody"><pre><code class="bash">&lt;?php
namespace Pyz\Client\Catalog\Plugin\Query;

use Elastica\Query;
use Elastica\Query\MatchAll;
use Generated\Shared\Search\PageIndexMap;
use Spryker\Client\Kernel\AbstractPlugin;
use Spryker\Client\Search\Dependency\Plugin\QueryInterface;

class MatchAllQueryPlugin extends AbstractPlugin implements QueryInterface
{

    /**
     * @var \Elastica\Query
     */
    protected $query;

    /**
     * @param string $searchString
     */
    public function __construct()
    {
        $this-&gt;query = $this-&gt;createSearchQuery();
    }

    /**
     * @return \Elastica\Query
     */
    public function getSearchQuery()
    {
        return $this-&gt;query;
    }

    /**
     * @return \Elastica\Query
     */
    protected function createSearchQuery()
    {
        $query = new Query();
        $query = $this-&gt;addMatchAllQuery($query);
        $query-&gt;setSource([PageIndexMap::SEARCH_RESULT_DATA]);

        return $query;
    }

    /**
     * @param \Elastica\Query $baseQuery
     *
     * @return \Elastica\Query
     */
    protected function addMatchAllQuery(Query $baseQuery)
    {
        $baseQuery-&gt;setQuery(new MatchAll());

        return $baseQuery;
    }

}</code></pre>
                        </div>
                    </div>
                    <p>In the example above, a simple query is created, which will return all the documents from our mapping type.</p>
                    <p>To execute this query you need to call the <var>search()</var> method of the <var>SearchClient</var>.</p>
                    <h3>Expanding queries</h3>
                    <p>Query expanders are a way to reuse partial queries to build more complex ones.</p>
                    <p>The suggested way to create queries is to create the simplest possible query as a base query for your usecase, then use query expanders to expand it with other reusable behaviours, such as pagination, sorting, etc.</p>
                    <p>You can create a new expander by implementing <var>\Spryker\Client\Search\Dependency\Plugin\QueryExpanderPluginInterface</var>.</p>
                    <p>Again, if you use query expanders, make sure that your base query is expandable, so it provides the same instance by calling <var>getSearchQuery()</var> multiple times.</p>
                    <p>To expand a base query with a collection of expanders, you’ll need to use <var>expandQuery()</var> method from the <var>SearchClient</var>.</p><pre><code class="bash">&lt;?php
    // ...

    /**
     * @var \Spryker\Client\Search\SearchClientInterface
     */
    protected $searchClient;

    // ...

    /**
     * @param \Spryker\Client\Search\Dependency\Plugin\QueryInterface $baseQuery
     * @param \Spryker\Client\Search\Dependency\Plugin\QueryExpanderPluginInterface[] $queryExpanders
     * @param array $requestParameters
     *
     * @return \Spryker\Client\Search\Dependency\Plugin\QueryInterface
     */
    protected function expandBaseQuery(QueryInterface $baseQuery, array $queryExpanders, array $requestParameters)
    {
        $searchQuery =  $this
            -&gt;searchClient
            -&gt;expandQuery($baseQuery, $queryExpanders, $requestParameters);

        return $searchQuery;
    }

    // ...</code></pre>
                    <p>At the moment, Spryker contains three query expander plugins that provide frequently used features.</p>
                    <p>These are all optional to use.</p>
                    <h3>Faceted navigation and filters</h3>
                    <p>The first query expander plugin is the <var>\Spryker\Client\Search\Plugin\Elasticsearch\QueryExpander\FacetQueryExpanderPlugin</var>. Its responsibility is to add the necessary aggregations to your query based on a predefined configuration (see: Configure search features section below). You can use this plugin to get the necessary data for faceted navigation of your search results. If you use this plugin, also make sure to add the <var>\Spryker\Client\Search\Plugin\Elasticsearch\ResultFormatter\FacetResultFormatterPlugin</var> to your result formatter collection, which takes care of processing the returned raw aggregation data.</p>
                    <h3>Paginating the results</h3>
                    <p>The next <i>query expander plugin</i> is the <var>\Spryker\Client\Search\Plugin\Elasticsearch\QueryExpander\PaginatedQueryExpanderPlugin</var>. It takes care of paginating your results based on the predefined configuration. If you use this plugin also make sure to add the <var>\Spryker\Client\Search\Plugin\Elasticsearch\ResultFormatter\PaginatedResultFormatterPlugin</var> to your result formatter collection.</p>
                    <h3>Sorting the results</h3>
                    <p>The last <i>query expander plugin</i> is the \Spryker\Client\Search\Plugin\Elasticsearch\QueryExpander\SortedQueryExpanderPlugin. It takes care of sorting your results based on the predefined configuration. The necessary result formatter for this plugin is \Spryker\Client\Search\Plugin\Elasticsearch\ResultFormatter\SortedResultFormatterPlugin.</p>
                    <h3>Process Query Result</h3>
                    <p>After you’ve created your query, you also need to take care of processing the raw response from <var>Elasticsearch</var>. This is done by providing a collection of <var>\Spryker\Client\Search\Dependency\Plugin\ResultFormatterPluginInterface</var>.</p>
                    <p>To create one you need to extend <var>\Spryker\Client\Search\Plugin\Elasticsearch\ResultFormatter\AbstractElasticsearchResultFormatterPlugin</var>.</p>
                    <p>It’s also possible to not provide any result formatters; in this case the raw response will be returned at the end.</p>
                    <div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Click to expand the code sample</a></span>
                        <div class="MCDropDownBody dropDownBody"><pre><code class="bash">&lt;?php
namespace Pyz\Client\Catalog\Plugin\ResultFormatter;

use Elastica\Result;
use Elastica\ResultSet;
use Generated\Shared\Search\PageIndexMap;
use Spryker\Client\Search\Plugin\Elasticsearch\ResultFormatter\AbstractElasticsearchResultFormatterPlugin;

class DummyResultFormatterPlugin extends AbstractElasticsearchResultFormatterPlugin
{

    const NAME = 'test';

    /**
     * @return string
     */
    public function getName()
    {
        return static::NAME;
    }

    /**
     * @param \Elastica\ResultSet $searchResult
     * @param array $requestParameters
     *
     * @return array
     */
    protected function formatSearchResult(ResultSet $searchResult, array $requestParameters)
    {
        $results = [];

        foreach ($resultSet-&gt;getResults() as $result) {
            $results[] = $this-&gt;formatResult($result);
        }

        return $results;
    }

    /**
     * @param \Elastica\Result $result
     *
     * @return mixed
     */
    protected function formatResult(Result $result)
    {
        // Do something with the result ...
        return $result;
    }

}</code></pre>
                        </div>
                    </div>
                    <p>To execute the previously created query along with this result formatter plugin, you need to call the <var>search()</var> method of the <var>SearchClient</var> and provide this formatter to its second parameter.</p>
                    <p>When you use result formatter plugins, the result of the <var>SearchClient::search()</var> method will be an associative array, where the keys are the name of each result formatters (provided by <var>getName() </var>method) and the values are the response for each result formatter.</p>
                    <p>This way in your controller where at the end you get the response you can simply provide everything you got right to the template to care of.</p>
                    <h2>Configure Search Features</h2>
                    <p>In this section you’ll learn how to configure faceted navigation, filters, pagination and sorting, so all the important search features that are provided by the <var>Search</var> <span class="Generalbundle/module">module</span>.</p>
                    <p>This configuration is only relevant if you enable the three query expanders and result formatters mentioned above.</p>
                    <p>Indirectly, they all require you to provide an instance of <var>\Spryker\Client\Search\Dependency\Plugin\SearchConfigBuilderInterface</var> by <var>\Spryker\Client\Search\SearchDependencyProvider::createSearchConfigPlugin()</var> method. So first of all you’ll need to implement this interface.</p><pre><code class="bash">&lt;?php
namespace Pyz\Client\Catalog\Plugin\Config;

use Spryker\Client\Kernel\AbstractPlugin;
use Spryker\Client\Search\Dependency\Plugin\SearchConfigBuilderInterface;

/**
 * @method \Spryker\Client\Catalog\CatalogFactory getFactory()
 */
class CatalogSearchConfigBuilder extends AbstractPlugin implements SearchConfigBuilderInterface
{
    // ...
}</code></pre>
                    <p>The first method we’ll implement in this interface is <var>buildFacetConfig()</var> where we configure our facet filters.</p>
                    <p>The goal here is to create <var>FacetConfigTransfer</var> instances with some data and push them for the <var>$facetConfigBuilder</var>.</p>
                    <p>Let’s assume that previously in our <var>PageMapInterface</var> we mapped an integer facet which we called “price” with some data (note the use of <var>addIntegerFacet()</var> in the example above), so now we would like to add a price range filter for that data.</p><pre><code class="bash">&lt;?php
namespace Pyz\Client\Catalog\Plugin\Config;

use Generated\Shared\Transfer\FacetConfigTransfer;
use Spryker\Client\Search\Dependency\Plugin\FacetConfigBuilderInterface;
// ...

    /**
     * @param \Spryker\Client\Search\Dependency\Plugin\FacetConfigBuilderInterface $facetConfigBuilder
     *
     * @return void
     */
    public function buildFacetConfig(FacetConfigBuilderInterface $facetConfigBuilder)
    {
        $priceFacet = (new FacetConfigTransfer())
            -&gt;setName('price')
            -&gt;setParameterName('price')
            -&gt;setFieldName(PageIndexMap::INTEGER_FACET)
            -&gt;setType(FacetConfigBuilder::TYPE_PRICE_RANGE);

        $facetConfigBuilder-&gt;addFacet($priceFacet);
    }

// ...</code></pre>
                    <p>You could create and add as many <var>FacetConfigTransfers</var> as you need. Let’s analyze this transfer’s options below:</p>
                    <ul>
                        <li value="1"><strong>setName()</strong>: Required field, the name of the target data to filter by.</li>
                        <li value="2"><strong>setParameterName()</strong>: Required field, the name that will be used in the request when the filter is used.</li>
                        <li value="3"><strong>setFieldName()</strong>: Required field, the name of the field of the page mapping type where the target data is stored.</li>
                        <li value="4"><strong>setType()</strong>: Required field, the type of the facet. Currently available options: “enumeration”, “bool”, “range”, “price_range”, “category”.</li>
                        <li value="5"><strong>setIsMultiValued()</strong>: Optional field, if set to <var>true</var> multiple values can be filtered with logical OR comparison.</li>
                    </ul>
                    <p>The next method we’ll implement is the <var>buildSortConfig()</var>, where we configure our sorting options. Let’s assume we’d like to sort by name and price and we’ve already added them when we implemented <var>PageMapInterface</var> (note the use of <var>addStringSort()</var> and <var>addIntegerSort()</var> in the example above).</p>
                    <div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Click to expand the code sample</a></span>
                        <div class="MCDropDownBody dropDownBody"><pre><code class="bash">&lt;?php
namespace Pyz\Client\Catalog\Plugin\Config;

use Generated\Shared\Transfer\SortConfigTransfer;
use Spryker\Client\Search\Dependency\Plugin\FacetConfigBuilderInterface;
// ...

    /**
     * @param \Spryker\Client\Search\Dependency\Plugin\SortConfigBuilderInterface $sortConfigBuilder
     *
     * @return void
     */
    public function buildSortConfig(SortConfigBuilderInterface $sortConfigBuilder)
    {
        $this
            -&gt;addAscendingNameSort($sortConfigBuilder)
            -&gt;addDescendingNameSort($sortConfigBuilder)
            -&gt;addAscendingPriceSort($sortConfigBuilder)
            -&gt;addDescendingPriceSort($sortConfigBuilder);
    }

    /**
     * @param \Spryker\Client\Search\Dependency\Plugin\SortConfigBuilderInterface $sortConfigBuilder
     *
     * @return $this
     */
    protected function addAscendingNameSort(SortConfigBuilderInterface $sortConfigBuilder)
    {
        $ascendingNameSortConfig = (new SortConfigTransfer())
            -&gt;setName('name')
            -&gt;setParameterName('name_asc')
            -&gt;setFieldName(PageIndexMap::STRING_SORT);

        $sortConfigBuilder-&gt;addSort($ascendingNameSortConfig);

        return $this;
    }

    /**
     * @param \Spryker\Client\Search\Dependency\Plugin\SortConfigBuilderInterface $sortConfigBuilder
     *
     * @return $this
     */
    protected function addDescendingNameSort(SortConfigBuilderInterface $sortConfigBuilder)
    {
        $ascendingNameSortConfig = (new SortConfigTransfer())
            -&gt;setName('name')
            -&gt;setParameterName('name_desc')
            -&gt;setFieldName(PageIndexMap::STRING_SORT)
            -&gt;setIsDescending(true);

        $sortConfigBuilder-&gt;addSort($ascendingNameSortConfig);

        return $this;
    }

    /**
     * @param \Spryker\Client\Search\Dependency\Plugin\SortConfigBuilderInterface $sortConfigBuilder
     *
     * @return $this
     */
    protected function addAscendingPriceSort(SortConfigBuilderInterface $sortConfigBuilder)
    {
        $priceSortConfig = (new SortConfigTransfer())
            -&gt;setName('price')
            -&gt;setParameterName('price_asc')
            -&gt;setFieldName(PageIndexMap::INTEGER_SORT);

        $sortConfigBuilder-&gt;addSort($priceSortConfig);

        return $this;
    }

    /**
     * @param \Spryker\Client\Search\Dependency\Plugin\SortConfigBuilderInterface $sortConfigBuilder
     *
     * @return $this
     */
    protected function addDescendingPriceSort(SortConfigBuilderInterface $sortConfigBuilder)
    {
        $priceSortConfig = (new SortConfigTransfer())
            -&gt;setName('price')
            -&gt;setParameterName('price_desc')
            -&gt;setFieldName(PageIndexMap::INTEGER_SORT)
            -&gt;setIsDescending(true);

        $sortConfigBuilder-&gt;addSort($priceSortConfig);

        return $this;
    }

// ...</code></pre>
                        </div>
                    </div>
                    <p>Similar to facet filters, here you can create and add as many <var>SortConfigTransfers</var> as you need. The transfer’s options are the following:</p>
                    <ul>
                        <li value="1"><strong>setName()</strong>: Required field, the name of the target data to sort by.</li>
                        <li value="2"><strong>setParameterName()</strong>: Required field, the name that will be used in the request when the sort is used.</li>
                        <li value="3"><strong>setFieldName()</strong>: Required field, the name of the field of the page mapping type where the target data is stored..</li>
                        <li value="4"><strong>setIsDescending()</strong>: Optional field, the sort direction is descending when this is set to true otherwise the sort direction is ascending by default.</li>
                    </ul>
                    <p class="info">
                        <br /><strong>Sort by relevance</strong>
                        <br />Note that Elasticsearch is by default sorting by relevance. The cost of each document is calculated based on your search query.<br /></p>
                    <p>The last method we’ll need to implement in the <var>CatalogSearchConfigBuilder</var> is the <var>buildPaginationConfig()</var> to configure the pagination of the results.</p>
                    <div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Click to expand the code sample</a></span>
                        <div class="MCDropDownBody dropDownBody"><pre><code class="bash">&lt;?php
namespace Pyz\Client\Catalog\Plugin\Config;

use Generated\Shared\Transfer\PaginationConfigTransfer;
use Spryker\Client\Search\Dependency\Plugin\FacetConfigBuilderInterface;
// ...

    const DEFAULT_ITEMS_PER_PAGE = 6;
    const VALID_ITEMS_PER_PAGE_OPTIONS = [6, 18, 36];

    /**
     * @param \Spryker\Client\Search\Dependency\Plugin\PaginationConfigBuilderInterface $paginationConfigBuilder
     *
     * @return void
     */
    public function buildPaginationConfig(PaginationConfigBuilderInterface $paginationConfigBuilder)
    {
        $paginationConfigTransfer = (new PaginationConfigTransfer())
            -&gt;setParameterName('page')
            -&gt;setItemsPerPageParameterName('ipp')
            -&gt;setDefaultItemsPerPage(self::DEFAULT_ITEMS_PER_PAGE)
            -&gt;setValidItemsPerPageOptions(self::VALID_ITEMS_PER_PAGE_OPTIONS);

        $paginationConfigBuilder-&gt;setPagination($paginationConfigTransfer);
    }

// ...</code></pre>
                        </div>
                    </div>
                    <p>This time we need to create only one instance from <var>PaginationConfigTransfer</var> and set it in the <var>$paginationConfigBuilder</var>. The transfer’s options are the following:</p>
                    <ul>
                        <li value="1"><strong>setParameterName()</strong>: Required field, the name that will be used in the request for the current page.</li>
                        <li value="2"><strong>setItemsPerPageParameterName()</strong>: Optional field, if defined this name will be used in the request for changing the items per page parameter.</li>
                        <li value="3"><strong>setDefaultItemsPerPage()</strong>: Optional field, the value of the default items per page.</li>
                        <li value="4"><strong>setValidItemsPerPageOptions()</strong>: Optional field, an array of valid items per page options.</li>
                    </ul>
                    <p>After fully implementing the config builder plugin, we’ll need to provide it on project level in the <var>SearchDependencyProvider</var>.</p>
                    <div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Click to expand the code sample</a></span>
                        <div class="MCDropDownBody dropDownBody"><pre><code class="bash">&lt;?php
namespace Pyz\Client\Search;

use Pyz\Client\Catalog\Plugin\Config\CatalogSearchConfigBuilder;
use Spryker\Client\Kernel\Container;
use Spryker\Client\Search\SearchDependencyProvider as SprykerSearchDependencyProvider;

class SearchDependencyProvider extends SprykerSearchDependencyProvider
{

    /**
     * @param \Spryker\Client\Kernel\Container $container
     *
     * @return \Spryker\Client\Search\Dependency\Plugin\SearchConfigBuilderInterface
     */
    protected function createSearchConfigBuilderPlugin(Container $container)
    {
        return new CatalogSearchConfigBuilder();
    }

}</code></pre>
                        </div>
                    </div>
                    <p>After you provided the instance of your search configuration builder, the <i>expander</i> and <i>result formatter</i> plugins will start to generate data next time you’ll run a search query. This tutorial doesn’t cover how to display the filters, but you can find examples using them in our Demoshop.</p>
                </div>
                <div class="t-page-sidebar__sidebar g-col g-col--sm-12 g-col--xl-4 u-is-hidden--sm-xl">
                    <section class="a-box a-box--shadow">
                        <nav class="m-nav-sidebar" id="nav-sidebar">
                            <ul class="nocontent menu _Skins_SideMenu mc-component" data-mc-is-context-sensitive="True" data-mc-linked-toc="Data/Tocs/spryker_content.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                            </ul>
                        </nav>
                    </section>
                </div>
            </main>
            <div class="t-base__footer">
                <footer class="o-footer g-grid g-grid--middle">
                    <nav class="g-grid g-grid--container g-grid--center"><a class="o-footer__link" href="https://spryker.com/privacy-policy" target="_blank">Privacy policy</a><a class="o-footer__link" href="https://spryker.com/partneragb" target="_blank">AGB Partnerprogram</a><a class="o-footer__link" href="https://spryker.com/impressum" target="_blank">Impressum</a>
                    </nav>
                </footer>
            </div><a class="a-scroll-top js-scroll-top" href="#"><span class="a-scroll-top__icon icon icon-chevron-up"></span></a>
            <div class="t-base__overlay js-base-template__toggler">
            </div>
        </div>
        <div class="t-base__off">
            <section class="o-off-canvas">
                <nav class="m-nav-mobile" id="nav-mobile">
                    <ul class="nocontent menu _Skins_SideMenu mc-component" data-mc-linked-toc="Data/Tocs/spryker_content.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                    </ul>
                </nav>
            </section>
        </div>
        <script src="/resources/public/js/academy-ui-vendor.js">
        </script>
        <script src="/resources/public/js/academy-ui-app.js">
        </script>
        <script>/* <![CDATA[ */
        (function(b, o, i, l, e, r) {
        b.GoogleAnalyticsObject = l;
        b[l] || (b[l] =
        function() {
        (b[l].q = b[l].q || []).push(arguments)
        });
        b[l].l = +new Date;
        e = o.createElement(i);
        r = o.getElementsByTagName(i)[0];
        e.src = 'https://www.google-analytics.com/analytics.js';
        r.parentNode.insertBefore(e, r)
        }(window, document, 'script', 'ga'));
        ga('create', 'UA-XXXXX-X', 'auto');
        ga('send', 'pageview');
    /* ]]> */</script>
    </body>
</html>
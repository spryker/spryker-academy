﻿<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:lastBlockDepth="4" MadCap:lastHeight="2479" MadCap:lastWidth="1258" style="">
    <head>
    </head>
    <body>
        <h1>Credit Card Payment - Payone</h1>
        <p class="info" MadCap:autonum="&lt;b&gt;Info: &lt;/b&gt; ">
            <br />PCI Compliance<br />Because of PCI compliance reasons, credit card data is communicated to the third party through AJAX calls (sensitive information stays browser side).
</p>
        <h2>PCI Compliance
</h2>
        <p>The Payment Card Industry Data Security Standard ( PCI DSS ) is a set of rules with the intention to ensure that credit card information is processed, stored and transmitted in a secure environment. </p>
        <p>The PCI standard applies to companies or organizations that enable making payments using credit cards.

The PCI compliance standard means that any merchant that offers credit card payments or is storing credit card information in the system is mandatory to pass a PCI certification. Processing and storing credit card data in the database involves a serious risk of financial fraud.

</p>
        <p>We do not store, credit card data in the database and the payment processing is done through payment service providers ( third parties). Our credit card payment integration is done only with PCI DSS certified payment service providers, so certification is not needed.

</p>
        <h2>Front-end Integration
</h2>
        <p>Run <var>antelope build yves</var> after you include the javascript file for credit card check inside the payment step template (e.g. <var>src/&lt;project_name&gt;/Yves/Checkout/Theme/&lt;custom_theme_name&gt;/checkout/payment.twig</var>)

</p><pre><code class="bash">
{% block content %}
    &lt;script src="/assets/default/js/spryker-yves-payone-main.js"&gt;&lt;/script&gt;
{% endblock %}
</code></pre>
        <p>To adjust frontend appearance, provide following templates in your theme directory:

</p>
        <ul>
            <li class="bullet_list"><var>src/&lt;project_name&gt;/Yves/Payone/Theme/&lt;custom_theme_name&gt;/credit_card.twig</var><![CDATA[
]]></li>
        </ul>
        <h2>State Machine Integration
</h2>
        <p>The Payone <MadCap:variable name="General.bundle/module" /> provides a demo state machine for Credit Card payment method which implements Pre-Authorization/Capture flow. It’s also possible to implement Authorization flow using corresponding command.

</p>
        <p>To enable the demo state machine, extend the configuration with the following values:

</p><pre><code class="bash">&lt;?php
$config[SalesConstants::PAYMENT_METHOD_STATEMACHINE_MAPPING] = [
    ...
    PayoneConfig::PAYMENT_METHOD_CREDIT_CARD =&gt; 'PayoneCreditCard',
];

$config[OmsConstants::ACTIVE_PROCESSES] = [
    ...
    'PayoneCreditCard',
];</code></pre>
        <h2>
Credit Card Payment Flow:
</h2>
        <ol>
            <li>A credit card check request is submitted to Payone ( through an AJAX call) The request sent to Payone is encrypted and it contains a secret key configured in the merchant account. The response contains a pseudo credit card pan : a token used to uniquely identify this transaction on third party side, on further communications.The pseudo credit card pan is stored in the database.

</li>
            <li>A checkout request is made to Spryker; depending if it’s a 3d secure credit card or a regular credit card, Spryker will manage to submit the payment on third party side and update the payment status. On authorizing or capturing requests, Spryker will use the pseudo credit card pan stored in the database as an identification token.

</li>
        </ol>
        <h2>System Interaction
</h2>
        <p>The diagram shows the interaction between the browser, Zed and Payone. We recommend using the creditcardcheck (1) AJAX call from the browser to Payone directly. If the credit card data is valid, Payone will return a credit card pseudo pan. This number must be used with all subsequent Payone interactions as a reference. Optionally the pseudo pan can be stored with an AJAX request into the session (2). When it comes to checkout (3) a state machine must be started. The state machine can either use an authorize call to obtain the money directly or use a preauthorize call (3.1) that blocks the money. If 3d-secure is enabled a redirect message must be handled. At the given time (when package is ready for shipment e.g.) the preauthorized money can be captured.
</p>
        <p>
            <img src="../../../Resources/Images/payone_system_interaction.png" class="Thumbnail" title="Click Me" alt="Payone System Interaction">
            </img><![CDATA[
 

]]></p>
        <p>Credit card Check is an AJAX request from the browser to Payone directly. Before sending the credit card data, it is encrypted with asymmetric encryption algorithm. If the credit card is valid, a Pseudocreditcardpan is returned. This will be used for all subsequent interactions with Payone. The advantage is that a PCI compliance may not be needed.
</p>
    </body>
</html>

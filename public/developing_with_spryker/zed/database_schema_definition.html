<!DOCTYPE html>
<html id="spryker-academy" lang="en-us" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Developing with Spryker|Zed|Persistence Layer">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0" />
        <meta name="author" content="Spryker Systems GmbH" />
        <meta name="title" content="Spryker Academy" />
        <meta name="msapplication-config" content="/resources/ui/images/favicons/browserconfig.xml" />
        <link rel="apple-touch-icon" sizes="180x180" href="/resources/ui/images/favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="/resources/ui/images/favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="/resources/ui/images/favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="/resources/ui/images/favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="/resources/ui/images/favicons/favicon-16x16.png" /><title>Database Schema Definition</title>
        <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <style>@import url('https://fonts.googleapis.com/css?family=Lato:300,400,400i,900');

</style>
        <link href="/resources/ui/css/academy-ui-typography.css" rel="stylesheet" />
        <link href="/resources/ui/css/academy-ui-app.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.previous-topic-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/navigate-previous.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.next-topic-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/navigate-next.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.expand-all-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/expand.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.print-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/printer.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.collapse-all-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/collapse.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.needs-pie
{
	behavior: url('../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <link href="../../resources/ui/css/academy-ui-typography.css" rel="stylesheet" />
        <script src="../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body class="t-base t-base--page js-base-template">
        <div class="t-base__header">
            <header class="o-header">
                <div class="o-header__content g-grid g-grid--container g-grid--middle"><a class="m-logo g-col g-col--sm-10 g-col--lg-2" href="/"><img class="m-logo__image" src="/resources/ui/images/logo.png" alt="Spryker Logo" /></a>
                    <nav class="m-nav-top g-col g-col--sm-2 g-col--lg-10" id="nav-top">
                        <div class="u-is-hidden--sm-xl">
                            <ul class="nocontent menu mc-component" data-mc-linked-toc="Data/Tocs/spryker_content.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                            </ul>
                        </div>
                        <div class="u-is-hidden--xl"><a class="m-nav-top__toggler js-base-template__toggler" href="#"><span class="icon icon-bars"></span></a>
                        </div>
                    </nav>
                </div>
            </header>
        </div>
        <div class="t-base__frame">
            <section class="o-search">
                <div class="g-grid g-grid--container">
                    <section class="m-search g-col g-col--sm-12">
                        <form action="/search.html" method="GET">
                            <input class="a-input a-input--expanded m-search__input" placeholder="Search in the Academy..." name="q" />
                            <button class="m-search__submit" type="submit"><span class="icon icon-search"></span>
                            </button>
                        </form>
                    </section>
                </div>
            </section>
            <section class="t-base__widgets g-grid g-grid--container g-grid--middle">
                <section class="m-breadcrumbs g-col g-col--sm-12 g-col--xl-8">
                    <div class="nocontent">
                        <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                        </div>
                    </div>
                </section>
                <div class="g-col g-col--sm-12 g-col--xl-4 u-align-right">
                    <section class="m-widget-toolbar">
                        <div class="buttons popup-container clearfix topicToolbarProxy _Skins_topic_toolbar mc-component nocontent">
                            <div class="button-group-container-left">
                                <button class="button needs-pie previous-topic-button" title="Navigate previous">
                                    <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="previous topic" />
                                </button>
                                <button class="button needs-pie next-topic-button" title="Navigate next">
                                    <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="next topic" />
                                </button>
                                <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                    <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="expand all" />
                                </button>
                                <button class="button needs-pie print-button" title="Print">
                                    <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="print" />
                                </button>
                            </div>
                        </div>
                    </section>
                    <div class="m-widget-github js-widget-github"><a class="m-widget-github__link icon icon-github js-widget-github__link" href="https://github.com/spryker/spryker-academy" target="_blank"></a>
                    </div>
                </div>
            </section>
            <main class="t-base__main g-grid g-grid--container">
                <div class="g-col g-col--sm-12 u-is-hidden--xl">
                    <div class="m-accordion js-accordion">
                        <div class="m-accordion__header">
                            <div class="m-accordion__title js-accordion__toggler"><span class="icon icon-ellipsis-v icon--left"></span>
                    Navigation
                </div>
                        </div>
                        <div class="m-accordion__content js-accordion__content">
                            <nav class="m-nav-sidebar" id="nav-sidebar">
                                <ul class="nocontent menu mc-component" data-mc-is-context-sensitive="True" data-mc-linked-toc="Data/Tocs/spryker_content.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
                <div class="t-page-sidebar__content o-content g-col g-col--sm-12 g-col--xl-8 js-anchorer js-highlighter js-widget-copy">
                    <h1>Database Schema Definition</h1>
                    <p>With Propel, a database schema is defined in an XML-file. Each <span class="Generalbundle/module">module</span> carries it’s own part of the big schema that is collected and merged.</p>
                    <p>Propel’s documentation on defining the database schema: <a href="http://propelorm.org/documentation/reference/schema.html" target="_blank">Database schema</a></p>
                    <h2>Example Schema XML File</h2>
                    <p>This file can be copied into your <span class="Generalbundle/module">module</span>into <var>(<span class="GeneralBundle/Module">Module</span>)/Persistence/Propel/Schema/</var>. Don’t forget to adopt it to your needs.</p><pre><code class="bash">&lt;?xml version="1.0"?&gt;
&lt;database name="zed"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="http://static.spryker.com/schema-01.xsd"
    namespace="Orm\Zed\Customer\Persistence"
    package="src.Orm.Zed.Customer.Persistence"&gt;

    &lt;table name="spy_customer" idMethod="native"&gt;
        &lt;column name="id_customer" required="true" type="INTEGER" autoIncrement="true" primaryKey="true" /&gt;
        &lt;column name="email" required="true" size="255" type="VARCHAR" /&gt;
        &lt;column name="first_name" size="100" type="VARCHAR" /&gt;
        &lt;column name="last_name" size="100" type="VARCHAR" /&gt;
        &lt;unique&gt;
            &lt;unique-column name="email" /&gt;
        &lt;/unique&gt;
    &lt;/table&gt;
&lt;/database&gt;</code></pre>
                    <p class="important"><strong>XML File Prefix</strong>
                        <br />The name of the XML file that contains DB schema definition must be prefixed with the <var>spy_</var> string</p>
                    <h3>Composed Names</h3>
                    <p>When you need to use a composed name for a field you define in your table, you need to use small cases and separate the words using underscores.</p>
                    <p>E.g.: <var>category_image_name</var></p>
                    <hr width="100%" size="0" />
                    <h2>Migrations</h2>
                    <p>To apply a change in the database schema, you need to run a command line call.</p><pre><code class="bash">vendor/bin/console propel:install</code></pre>
                    <p>The schema migration is part of the setup:install call.</p>
                    <p>The workflow can be described like this:</p>
                    <ul>
                        <li class="bullet_list" value="1">Collect the schema-xml files from all bundles</li>
                        <li class="bullet_list" value="2">Merge schemas and copy them into one directory ( src/Generated/Propel/DE/Schema )</li>
                        <li class="bullet_list" value="3">Generation of entities and query objects</li>
                        <li class="bullet_list" value="4">Diff of new and existing schema</li>
                        <li class="bullet_list" value="5">Run migration</li>
                    </ul>
                    <hr width="100%" size="0" />
                    <h2>Schema File Merge</h2>
                    <p>Sometimes it is useful to add columns to a table which belongs to another <span class="Generalbundle/module">module</span>. Possible use cases:</p>
                    <ul>
                        <li class="bullet_list" value="1">A core <span class="Generalbundle/module">module</span> wants to inject a foreign key into a table from another core <span class="Generalbundle/module">module</span>. This happens when the dependency direction is in contrast to the direction of the relation.</li>
                        <li class="bullet_list" value="2">A project <span class="Generalbundle/module">module</span> wants to add a column to a table from a core <span class="Generalbundle/module">module</span>.</li>
                    </ul>
                    <p>When you add a column to a core table, this column must not be mandatory, because in this case the core classes, not knowing the mandatory fields, become unusable and thus have to be overwritten, which increases the difficulty to update. In most cases you can and should avoid adding a column to a core table. This can cause compatibility problems in the future. What happens, when the next release adds a column with the same name but another meaning? To avoid this problem it is a good practice to add a new table and use a one-to-one relationship.</p>
                    <h3>Merge Workflow</h3>
                    <p>The merging works like this:</p>
                    <ol>
                        <li value="1">Find all schema xml files from core and project level</li>
                        <li value="2">Group them by filename</li>
                        <li value="3">Check number of files per filename</li>
                    </ol>
                    <ul style="list-style-type: circle;">
                        <li class="bullet_list" value="1">If one filename has one path: copy to <var>src/Orm/Propel/DE/Schema</var></li>
                        <li class="bullet_list" value="2">If one filename has more than one path: merge them<ul style="list-style-type: square;"><li class="bullet_list" value="1">Check if the database attributes name, package and namespace are consistent, otherwise throw exception</li><li class="bullet_list" value="2">Merge xml by the name attribute on all levels</li><li class="bullet_list" value="3">Copy merged xml to <var>src/Orm/Propel/DE/Schema</var></li></ul></li>
                    </ul>
                    <h3>Merge Example</h3>
                    <p><var>src/Spryker/Zed/Customer/Persistence/Propel/Schema/spy_customer.schema.xml</var>
                    </p><pre><code class="bash">&lt;table name="spy_customer" idMethod="native"&gt;
    &lt;column name="first_name" size="100" type="VARCHAR" /&gt;
&lt;/table&gt;</code></pre>
                    <p><var>YourProject/Zed/Acl/Persistence/Propel/Schema/spy_customer.schema.xml</var>
                    </p><pre><code class="bash">&lt;table name="spy_customer"&gt;
    &lt;column name="last_name" size="100" type="VARCHAR" /&gt;
&lt;/table&gt;</code></pre>
                    <p>Merged file :</p><pre><code class="bash">&lt;table name="spy_customer" idMethod="native"&gt;
    &lt;column name="first_name" size="100" type="VARCHAR" /&gt;
    &lt;column name="last_name" size="100" type="VARCHAR" /&gt;
&lt;/table&gt;</code></pre>
                    <h3>Case Insensitive Fields</h3>
                    <p>
            MySQL provides case insensitive text type and this paragraph is mostly related to PostgreSql. But you still could have
            some benefits from using case insensitive text fields (e.g handling lower/upper case comparison on DB side).
        </p>
                    <p>
            Sometime a table requires a case insensitive field. A good example is <var>email</var> field.
            A customer should not be able to register twice with the same email but different character case.
        </p>
                    <p>
            To enable this option just set <var>column</var> attribute <var>caseInsensitive</var> with <var>true</var> in a
            schema XML file of a target table.
</p>
                    <p>&#160;</p>
                    <p><i>Last review date: Nov. 13th, 2017</i>
                    </p>
                    <p>&#160;</p>
                    <p />
                </div>
                <div class="t-page-sidebar__sidebar g-col g-col--sm-12 g-col--xl-4 u-is-hidden--sm-xl">
                    <section class="a-box a-box--shadow">
                        <nav class="m-nav-sidebar" id="nav-sidebar">
                            <ul class="nocontent menu mc-component" data-mc-is-context-sensitive="True" data-mc-linked-toc="Data/Tocs/spryker_content.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                            </ul>
                        </nav>
                    </section>
                </div>
            </main>
            <div class="t-base__footer">
                <footer class="o-footer g-grid g-grid--middle">
                    <nav class="g-grid g-grid--container g-grid--center"><a class="o-footer__link" href="https://spryker.com/privacy-policy" target="_blank">Privacy policy</a><a class="o-footer__link" href="https://spryker.com/partneragb" target="_blank">AGB Partnerprogram</a><a class="o-footer__link" href="https://spryker.com/impressum" target="_blank">Impressum</a>
                    </nav>
                </footer>
            </div><a class="a-scroll-top js-scroll-top" href="#"><span class="a-scroll-top__icon icon icon-chevron-up"></span></a>
            <div class="t-base__overlay js-base-template__toggler">
            </div>
        </div>
        <div class="t-base__off">
            <section class="o-off-canvas">
                <nav class="m-nav-mobile" id="nav-mobile">
                    <ul class="nocontent menu mc-component" data-mc-linked-toc="Data/Tocs/spryker_content.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                    </ul>
                </nav>
            </section>
        </div>
        <script src="/resources/ui/js/academy-ui-manifest.js">
        </script>
        <script src="/resources/ui/js/academy-ui-vendor.js">
        </script>
        <script src="/resources/ui/js/academy-ui-app.js">
        </script>
        <script>/* <![CDATA[ */
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-56589105-2', 'auto');
        ga('send', 'pageview');
    /* ]]> */</script>
        <script type="text/javascript" id="hs-script-loader" src="//js.hs-scripts.com/2770802.js">
        </script>
    </body>
</html>